<!DOCTYPE html>
<html>
<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
   padding-top: 40px;
   padding-bottom: 40px;
   background-color: #ADABAB;
}

h1{
   position: fixed;
   text-align: center;
   color: #017572;
   font-size: 40px;
}

h3{
  position: relative;
  text-align: center;
  margin-top: 0;
  color: white;
  font-size: 20px;
  font-weight: normal;
  font-family: "Times New Roman", Times, serif;
}

.rad_txt{
  color: #017572;
}

.btn {
  background-color: #017572;
  font-family: "Times New Roman", Times, serif;
  border-style: solid;
  border-color: #191919;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 20px;
  margin: 4px 2px;
  cursor: pointer;
}

/* Gray */
.left {
  position: fixed;
  left: 15px;
  top: 30px;
  transition: all 500ms ease-in-out;
}

.right {
  position: fixed;
  right: 15px;
  top: 30px;
  transition: all 500ms ease-in-out;
}

.logout {
  position: fixed;
  left: 15px;
  top: 100px;
  transition: all 500ms ease-in-out;
}

.config {
  position: fixed;
  right: 15px;
  top: 100px;
  transition: all 500ms ease-in-out;
}

.save {
  position: fixed;
  left: 15px;
  top: 100px;
  transition: all 500ms ease-in-out;
}

.display {
  position: fixed;
  left: 15px;
  top: 170px;
  transition: all 500ms ease-in-out;
}


.right:hover {
  color: black;
  transition: all 500ms ease-in-out
}

.left:hover {
  color: black;
  transition: all 500ms ease-in-out
}

.left-div
{
     position: relative;
     left: 10vw;
     width: 90px;
     background-color: #191919;
     border-style: solid;
     padding-bottom: 10px;
     padding-left: 10px;
     padding-right: 10px;
     padding-top: 10px;
}

.right-div
{
     position: absolute;
     left: 50%;
     width: 100px;
}

.center-div
{
     position: relative;
     margin: auto;
}

img {
  display: block;
}

.floorplan {
  position: relative;
  top: 75px;
  width: 40vw;
  left: 35%;

}

div {
  padding-top: 20px;
}

.show {display: block;}

.leftDiv {
  height: 100vh;
  position: fixed;
  left: 5%;
  top: 20%;
  width: 20vw;
}

.rightDiv {
  position: absolute;
  left: 60%;
  top: 20%;
  width: 20vw;
}


.right_container {
  position: fixed;
  width: 200px;
  right: 15px;
  top: 100px;
  height: 140px;
  background-color: #017572;
  border-style: solid;
  border-color: #191919;
}

/* The container */
.container {
  display: block;
  position: relative;
  padding-left: 40px;
  font-family: "Times New Roman", Times, serif;
  margin-bottom: 12px;
  cursor: pointer;
  color: white;
  font-size: 16px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default radio button */
.container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  top: 0;
  left: 5px;
  height: 25px;
  width: 25px;
  background-color: #eee;
  border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
  background-color: #ccc;
}

/* When the radio button is checked, add a blue background */
.container input:checked ~ .checkmark {
  background-color: black;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the indicator (dot/circle) when checked */
.container input:checked ~ .checkmark:after {
  display: block;
}

/* Style the indicator (dot/circle) */
.container .checkmark:after {
 	top: 9px;
	left: 9px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: white;
}

.dropbtn {
  background-color: #017572;
  color: white;
  padding: 16px;
  font-size: 16px;
  border-style: solid;
  border-color: black;
  cursor: pointer;
    position: fixed;
  right: 15px;
  top: 30px;
  transition: all 500ms ease-in-out;
}



.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
    position: fixed;
  right: 15px;
  top: 80px;
  transition: all 500ms ease-in-out;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;}

</style>
</head>
<body>

<button class="btn left" onclick="location.href='myaccount.html'">My Account</button>

<div class="dropdown">
  <button onclick="myFunction()" class="dropbtn">Dropdown</button>
  <div id="myDropdown" class="dropdown-content">
    <a onclick="addLight()">Light</a>
    <a onclick="addCurtain()">Curtain</a>
    <a onclick="addThermostat()">Thermostat</a>
  </div>
</div>

<button class="btn logout" onclick="location.href='loginpage.php'">Sign Out</button>


<h1 class="center-div">Your Devices</h1>

<div class="leftDiv"></div>

<div class="rightDiv"></div>


<div class="right_container">
<h3>Configuration:</h3>
<label class="container">Day
  <input type="radio" name="radio" onclick="day()" id="cDay">
  <span class="checkmark"></span>
</label>
<label class="container">Night
  <input type="radio" name="radio" onclick="night()" id="cNight">
  <span class="checkmark"></span>
</label>
<label class="container">Away
  <input type="radio" name="radio" onclick="away()" id="cAway">
  <span class="checkmark"></span>
</label>
</div>
</div>


<img src="floorplan.png" alt="Floorplan" style="z-index:-10" class="floorplan">

<script>
//Create database if not created
$.post(
    "createdatabase.php",
    function(data, status) {// success callback
    						console.log('status: ' + status + ', data: ' + data);
      });

//Retrieve json data
$.post(
    "returndata.php",
      { name: "root" },
      function(response) {

      }, 'json'
  );

//Parse json
var xmlhttp = new XMLHttpRequest();

add.count = -1;
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var jsonData  = JSON.parse(this.responseText);
        for (var i = 0; i < jsonData.length; i++) {
          console.log(jsonData[i].name);
          add(jsonData[i].type, jsonData[i].id, jsonData[i].name,
            jsonData[i].amountDay,
              jsonData[i].amountNight, jsonData[i].amountAway,
             jsonData[i].pos1, jsonData[i].pos2);
        }
        if (jsonData.length > 0) {
          add.count = jsonData[jsonData.length - 1].id;
        }
    }
};
xmlhttp.open("GET", "returndata.php", true);
xmlhttp.send();

//Check config
   var configVal = localStorage.getItem("config");
   var ele;
   if (configVal == "night") {
      ele = document.getElementById("cNight");
  } else if (configVal == "away") {
      ele = document.getElementById("cAway");
  }  else {
      ele = document.getElementById("cDay");
  }
    ele.setAttribute("checked", "checked");

function add(type, id, name, valDay, valNight, valAway, pos1, pos2) {
  add.count++;
  if (id == null) {
    id = add.count;
    valDay = 50;
    valNight = 50;
    valAway = 50;
    pos1 = 0;
    pos2 = 0;
    name = "D" + add.count;
    insert(id, name, valDay, valNight, valAway, type, pos1, pos2);
  }

  var con = document.createElement('div');
  con.setAttribute("class", "left-div");
  con.style.width = "200px";
  con.id = "D" + id;
  var leftDiv = document.getElementsByClassName("leftDiv")[0];
  leftDiv.appendChild(con);

  var q = document.createTextNode(type);
  con.appendChild(q);

  var s = document.createTextNode('\u00A0\u00A0');
  con.appendChild(s);

  con.style.color = "white";
  var m = document.createElement("INPUT");
  m.setAttribute("type", "text");
  m.setAttribute("value", name);
  con.appendChild(m);

  var t = document.createElement("BUTTON");
  t.innerHTML = "OK";
  t.onclick = function()  {
    name = m.value;
    insert(id, name, valDay, valNight, valAway, type, null, null);
    location.reload();
  }
  con.appendChild(t);

  var x = document.createElement("INPUT");
  x.setAttribute("type", "range");
  if (localStorage.getItem("config") == "night") {
      x.setAttribute("value", valNight);
  } else if (localStorage.getItem("config") == "away") {
      x.setAttribute("value", valAway);
  } else {
    x.setAttribute("value", valDay);
  }
  x.setAttribute("class", "slider");
  x.oninput = function() {
    if (localStorage.getItem("config") == "night") {
        valNight = x.value;
    } else if (localStorage.getItem("config") == "away") {
        valAway = x.value;
    } else {
      valDay = x.value;
    }
    r.nodeValue = "    " + x.value + "   ";
    insert(id, name, valDay, valNight, valAway, type);
  }
  con.appendChild(x);

  if (localStorage.getItem("config") == "night") {
      var r = document.createTextNode("    " + valNight + "   ");
  } else if (localStorage.getItem("config") == "away") {
    var r = document.createTextNode("    " + valAway + "   ");
  } else {
    var r = document.createTextNode("    " + valDay + "   ");
  }
  con.appendChild(r);

  var img_con = document.createElement('div');
  img_con.setAttribute("class", "right-div");
  img_con.style.width = "30px";
  img_con.style.height = "40px";
  var img_id = "I" + id;
  img_con.id = img_id;
  var rightDiv = document.getElementsByClassName("rightDiv")[0];
  rightDiv.appendChild(img_con);

  var img = document.createElement('IMG');
  if (type == "Light") {
    img.setAttribute("src", "lightbulb.png");
  } else if (type == "Curtain") {
    img.setAttribute("src", "curtain.png");
  } else if (type == "Thermostat") {
    img.setAttribute("src", "thermostat.png");
  }
  img.setAttribute("class", "img");
  img.setAttribute("height", "40");
  img.setAttribute("width", "40");
  img_con.appendChild(img);

  var p = document.createTextNode(name);
  img_con.appendChild(p);

  img_el = document.getElementById(img_id);
  img_el.style.top = (pos1) + "px";
  img_el.style.left = (pos2) + "px";
  dragElement(img_el, id, name, valDay, valNight, valAway);

  var y = document.createElement("BUTTON");
  y.innerHTML = "Delete";
  y.onclick = function()  {
    con.remove();
    img_con.remove();
    remove(id);
  }
  con.appendChild(y);
}

  function dragElement(elmnt, id) {
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    elmnt.onmousedown = dragMouseDown;

    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      // get the mouse cursor position at startup:
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      // call a function whenever the cursor moves:
      document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
      e = e || window.event;
      e.preventDefault();
      // calculate the new cursor position:
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      // set the element's new position:
      elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
      elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
      /* stop moving when mouse button is released:*/
      document.onmouseup = null;
      document.onmousemove = null;
      var rect = elmnt.getBoundingClientRect();
      var rightDiv = document.getElementsByClassName("rightDiv")[0];
      var divRect = rightDiv.getBoundingClientRect();
      insert(id, null, null, null, null, null, rect.top - divRect.top, rect.left - divRect.left);
    }
}

function insert(d, n, valDay, valNight, valAway, type, p1, p2) {
  $.post("savesettings.php",
  {
      id: d,
      name: n,
      amountDay: valDay,
      amountNight: valNight,
      amountAway: valAway,
      type: type,
      pos1: p1,
      pos2: p2,
  },
  function(data, status) {// success callback
						console.log('status: ' + status + ', data: ' + data);
  });
}

function remove(val) {
  $.post("remove.php",
  {
      name: val,
  },
  function(data, status) {// success callback
						console.log('status: ' + status + ', data: ' + data);
  });
}

  function day() {
    localStorage.setItem("config", "day");
    location.reload();
  }
  function night() {
    localStorage.setItem("config", "night");
    location.reload();
  }
  function away() {
    localStorage.setItem("config", "away");
    location.reload();
  }

  function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

function addLight() {
  add("Light", null, null, null, null, null, null, null);
}
function addCurtain() {
  add("Curtain", null, null, null, null, null, null, null);
}
function addThermostat() {
  add("Thermostat", null, null, null, null, null, null, null);
}

</script>


</body>
</html>
